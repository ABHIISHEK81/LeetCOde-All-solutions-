//  3652. Best Time to Buy and Sell Stock using Strategy  //













class Solution(object):
    def maxProfit(self, prices, strategy, k):
        """
        :type prices: List[int]
        :type strategy: List[int]
        :type k: int
        :rtype: int
        """
        n = len(prices)
        
        profit = [strategy[i] * prices[i] for i in range(n)]
        base_profit = sum(profit)
        
        prefix_profit = [0] * (n + 1)
        prefix_price = [0] * (n + 1)
        
        for i in range(n):
            prefix_profit[i + 1] = prefix_profit[i] + profit[i]
            prefix_price[i + 1] = prefix_price[i] + prices[i]
        
        max_gain = 0
        half = k // 2
        
        for i in range(n - k + 1):
            orig = prefix_profit[i + k] - prefix_profit[i]
            modified = prefix_price[i + k] - prefix_price[i + half]
            
            gain = modified - orig
            max_gain = max(max_gain, gain)
        
        return base_profit + max_gain
